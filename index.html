<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCSelect2</title>

    <link rel="stylesheet" href="mcselect2.css" type="text/css">

    <style>
        * {
            box-sizing: border-box;
        }

        html, body {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <form action="save">
          You Selected: 
          <span id="showSelected"></span>

          <br>
          <br>
          <br>

        <select name="mySelect" id="mySelect">
            <option value="58202">Paganico Sabino</option>
            <option value="58203">Pagazzano</option>
            <option value="58204">Pagliara</option>
            <option value="58205">Pagliare</option>
            <option value="58206">Pagliare</option>
            <option value="58207">Pagliarelle</option>
            <option value="58208">Pagliarone</option>
            <option value="58209">Paglieta</option>
            <option value="58210">Pagnacco</option>
            <option value="58211">Pagno</option>
            <option value="58212">Pagnona</option>
            <option value="58213">Pago Veiano</option>
            <option value="58214">Pago del Vallo di Lauro</option>
            <option value="58215">Paisco Loveno</option>
            <option value="58216">Paitone</option>
            <option value="58217">Paladina</option>
            <option value="58218">Palagano</option>
            <option value="58219">Palagianello</option>
            <option value="58220">Palagiano</option>
            <option value="58221">Palagonia</option>
          </select>

          <br>
          <br>

          <div id="customDiv"></div>

          <br>
          <br>

          <div id="customDiv2"></div>
        </form>
    </div>

    <script src="mcselect2.js"></script>
    <script>
        // Get Data From Select Element
        const ms2 = new MCSelect2({
            selectBackground: 'linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(174,174,174,1) 91%)',
            debug: false,
            onTyping: (data) => { console.log('MS2, onTyping data: ', data) },
        })

        const ms3 = new MCSelect2({
            selectBackground: 'linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(174,174,174,1) 91%)',
            debug: false,
            source: 'data',
            data: () => {
                return [
                    {
                        id: 1,
                        text: 'Formaggio',
                    },
                    {
                        id: 2,
                        text: 'Capra',
                        isSelected: true,
                    },
                    {
                        id: 3,
                        text: 'New York',
                    },
                    {
                        id: 4,
                        text: 'Yogurt',
                    },
                ]
            },
            hideOriginalSelect: false,
            processRow: ($row) => {
                console.log('$row: ', $row)

                return {
                    optionValue: $row.id,
                    optionText: $row.text,
                    isOptionSelected: $row.selected ? $row.selected : false,
                }
            },
            onTyping: (data) => { console.log('MS3, onTyping data: ', data) },
        })

        // Fetch Data From Api
        const ms4 = new MCSelect2({
            selectBackground: 'linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(174,174,174,1) 91%)',
            debug: true,
            source: 'data',
            isAsync: true,
            data: async () => {
                try {
                    var $data = await fetch('https://jsonplaceholder.typicode.com/users')
                        .then(response => response.json())
                        .then(json => json.map((row) => {
                                return {
                                    id: row.id,
                                    username: row.username,
                                }
                            })
                        );
                } catch (error) {
                    console.log('Fetch Error: ', error);
                }
                
                console.log('$data1: ', $data);

                return $data;
            },
            hideOriginalSelect: false,
            processRow: ($row) => {
                console.log('$row: ', $row)

                return {
                    optionValue: $row.id,
                    optionText: $row.username,
                    isOptionSelected: false,
                }
            },
            onTyping: (data) => { console.log('MS3, onTyping data: ', data) },
        })

        document.addEventListener('DOMContentLoaded', () => {
            ms2.attach('#mySelect');
            ms3.attach('#customDiv');
            ms4.attach('#customDiv2');

            
            // Attach Event on standard select
            /* document.getElementById('mySelect').addEventListener('change', (ev) => {
                console.log('#mySelect value changed: ', ev.target.value)
                document.getElementById('showSelected').innerHTML = ms2.selectedOption.text
            }); */

            // Attach Event On Custom Event
            ms2.addEventListener('mcselect2-option-selected', (ev) => {
                const selectedOption = ev.detail.selectedOption
                console.log('#mySelect value changed: ', selectedOption)
                
                document.getElementById('showSelected').innerHTML = selectedOption.text
            });

            // Attach Event On Custom Event
            ms3.addEventListener('mcselect2-option-selected', (ev) => {
                const selectedOption = ev.detail.selectedOption
                console.log('#customDiv value changed: ', selectedOption)
                
                document.getElementById('showSelected').innerHTML = selectedOption.text
            });
        });
    </script>
</body>
</html>